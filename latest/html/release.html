

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Creating Releases of PyCBC &mdash; PyCBC 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="PyCBC 0.1 documentation" href="index.html"/>
        <link rel="next" title="Installing PyCBC" href="install.html"/>
        <link rel="prev" title="Documenting PyCBC code" href="documentation.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> PyCBC
          

          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing PyCBC</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="workflow/pycbc_make_psd_estimation_workflow.html"><code class="docutils literal"><span class="pre">pycbc_make_psd_estimation_workflow</span></code>: A workflow generator for noise estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow/pycbc_make_coinc_search_workflow.html"><code class="docutils literal"><span class="pre">pycbc_make_coinc_search_workflow</span></code>: A workflow to search for gravitational waves</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow/pycbc_make_sngl_workflow.html"><code class="docutils literal"><span class="pre">pycbc_make_sngl_workflow</span></code>: A single-ifo detchar workflow generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow/pygrb.html"><code class="docutils literal"><span class="pre">pycbc_make_offline_grb_workflow</span></code>: A GRB triggered CBC analysis workflow generator</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tmpltbank.html">PyCBC template bank generation documentation (<code class="docutils literal"><span class="pre">pycbc.tmpltbank</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="hwinj.html">Hardware injection waveform generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="banksim.html">Calculating the Effectualness (Fitting Factor) of Template Banks</a></li>
<li class="toctree-l1"><a class="reference internal" href="faithsim.html">Dag Generator for Doing Faithfulness Comparisons</a></li>
<li class="toctree-l1"><a class="reference internal" href="upload_to_gracedb.html">Uploading triggers to gracedb</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="waveform.html">Waveforms</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="documentation.html">Documenting PyCBC code</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Creating Releases of PyCBC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-the-release-on-github">Creating the release on GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="#uploading-to-the-python-package-index">Uploading to the Python Package Index</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-static-binaries-for-production-runs">Creating static binaries for production runs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preliminaries">Preliminaries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="install.html">Installing PyCBC</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#lalapps-inspinj">lalapps_inspinj</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-lalapps-programs">Other lalapps programs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#segment-database-tools">Segment database tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pycbc-binaries">pyCBC binaries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pycbc-inspiral">pycbc_inspiral</a></li>
<li class="toctree-l3"><a class="reference internal" href="#finishing-up">Finishing up</a></li>
<li class="toctree-l3"><a class="reference internal" href="#saving-virtual-environment">Saving Virtual Environment</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="frame.html">Reading Gravitational-wave Frames (<code class="docutils literal"><span class="pre">pycbc.frame</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="formats/hdf_format.html">HDF files within the PyCBC workflow</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="workflow.html">Workflow: the inspiral analysis workflow generator (<code class="docutils literal"><span class="pre">pycbc.workflow</span></code>)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">pycbc</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">PyCBC</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Creating Releases of PyCBC</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/release.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="creating-releases-of-pycbc">
<h1>Creating Releases of PyCBC<a class="headerlink" href="#creating-releases-of-pycbc" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only authorized maintainers of PyCBC should use these instructions.</p>
</div>
<div class="section" id="creating-the-release-on-github">
<h2>Creating the release on GitHub<a class="headerlink" href="#creating-the-release-on-github" title="Permalink to this headline">¶</a></h2>
<p>To create a new PyCBC release:</p>
<ol class="arabic simple">
<li>Make sure that the setup.py file contains the correct version number, which should be in the format <code class="docutils literal"><span class="pre">x.y.x</span></code> (where x, y, and z are the major, minor, and patch levels of the release) in PyCBC&#8217;s setup.py file.</li>
<li>Set <code class="docutils literal"><span class="pre">release</span> <span class="pre">=</span> <span class="pre">True</span></code> in the PyCBC&#8217;s setup.py file.</li>
<li>Commit the changed setup.py file and push to commit to the repository.</li>
<li>Go to the <a class="reference external" href="https://github.com/ligo-cbc/pycbc/releases">PyCBC release page</a> and click on <code class="docutils literal"><span class="pre">Draft</span> <span class="pre">a</span> <span class="pre">new</span> <span class="pre">release</span></code>.</li>
<li>Enter a tag version in the format <code class="docutils literal"><span class="pre">vx.y.z</span></code>. Note the <code class="docutils literal"><span class="pre">v</span></code> in front of the major, minor, and patch numbers.</li>
<li>Enter a descriptive release title and write a desciption of the release in the text box provided.</li>
<li>Click on <code class="docutils literal"><span class="pre">Publish</span> <span class="pre">release</span></code> to create the release.</li>
<li>Update the setup.py file with an incremented major or minor version number and make sure that the string <code class="docutils literal"><span class="pre">dev</span></code> appears in that version. For example, if you just released <code class="docutils literal"><span class="pre">1.2.1</span></code> then change the string to <code class="docutils literal"><span class="pre">1.3.dev0</span></code> or <code class="docutils literal"><span class="pre">2.0.dev0</span></code> as appropriate. This is need to ensure that if someone is building from source, it always takes precedence over an older release version.</li>
<li>Set <code class="docutils literal"><span class="pre">release</span> <span class="pre">=</span> <span class="pre">False</span></code> in PyCBC&#8217;s setup.py file.</li>
<li>Commit these changes and push them to the repository.</li>
</ol>
</div>
<div class="section" id="uploading-to-the-python-package-index">
<h2>Uploading to the Python Package Index<a class="headerlink" href="#uploading-to-the-python-package-index" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Keep in mind that once you register a version number with the package index and upload a package, you can never change it. You can only deactivate the package from the index, and increment the version number.</p>
</div>
<dl class="docutils">
<dt>If this is the first time that you have pushed to PyPI, you will need to create a configuration file. Create a file in your home directory called <code class="docutils literal"><span class="pre">.pypirc</span></code> that contains the lines::</dt>
<dd><p class="first">[distutils] # this tells distutils what package indexes you can push to
index-servers =
pypi
pypitest</p>
<p>[pypi]
repository: <a class="reference external" href="https://pypi.python.org/pypi">https://pypi.python.org/pypi</a>
username: your_username
password: your_password</p>
<p class="last">[pypitest]
repository: <a class="reference external" href="https://testpypi.python.org/pypi">https://testpypi.python.org/pypi</a>
username: your_username
password: your_password</p>
</dd>
</dl>
<p>Replace <code class="docutils literal"><span class="pre">your_username</span></code> and <code class="docutils literal"><span class="pre">your_password</span></code> with your PyPI and PyPI testing usernames and passwords.</p>
<p>Once you have tagged the release of PyCBC a tarball should be available from the <a class="reference external" href="https://github.com/ligo-cbc/pycbc/releases">GitHib PyCBC releases page</a>. Download this tarball, untar it, and change into the source directory of the tarball.</p>
<p>First check the release with the PyPI test repository. Register the package with</p>
<div class="code bash highlight-python"><div class="highlight"><pre>python setup.py register -r pypitest
</pre></div>
</div>
<p>If you get no errors, you can then upload the package with</p>
<div class="code bash highlight-python"><div class="highlight"><pre>python setup.py sdist upload -r pypitest
</pre></div>
</div>
<p>You should now see the package uploaded in the <a class="reference external" href="https://testpypi.python.org/pypi">PyPI Test Repository</a>. If this is successful, you can puhlish it to the main repository with the commands</p>
<div class="code bash highlight-python"><div class="highlight"><pre>python setup.py register -r pypi
python setup.py sdist upload -r pypi
</pre></div>
</div>
<p>The package should then be available in PyPI for download.</p>
</div>
<div class="section" id="creating-static-binaries-for-production-runs">
<h2>Creating static binaries for production runs<a class="headerlink" href="#creating-static-binaries-for-production-runs" title="Permalink to this headline">¶</a></h2>
<p>Static binaries are entirely self-contained programs that</p>
<ol class="arabic simple">
<li>Can be run by anyone, whether or not they have set up a development environment</li>
<li>Ensure that each program runs with the right versions of all dependancies</li>
<li>can be distributed from a central location</li>
</ol>
<p>A new set of such binaries should be generated for every release.</p>
<div class="section" id="preliminaries">
<h3>Preliminaries<a class="headerlink" href="#preliminaries" title="Permalink to this headline">¶</a></h3>
<p>To set up an environment for the release first follow the standard installation
instructions here:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing PyCBC</a></li>
</ul>
</div>
<p>If the default Python is 2.6 it will be useful to name your virtual environment
something like <code class="docutils literal"><span class="pre">pycbc_dev2.6</span></code>, since a subsequent step will require a 2.7
environment.
.. note:</p>
<div class="highlight-python"><div class="highlight"><pre>The bundles can still pull files from the virtual environment that you create. To prevent this it is necessary to ensure that the build environment does not persist after you create the bundles.
</pre></div>
</div>
<p>In order to distribute the binaries it will first be necessary to have a copy of the git
repository</p>
<div class="code highlight-python"><div class="highlight"><pre>git clone git@code.pycbc.phy.syr.edu:ligo-cbc/pycbc-software.git
</pre></div>
</div>
<p>Note that this will take a very long time.  Once the repository has been cloned
create a directory for the new release.</p>
<div class="code bash highlight-python"><div class="highlight"><pre>mkdir -p v1.2.5/x86_64/composer_xe_2015.0.090
</pre></div>
</div>
<p>changing version number and architecture as appropriate.</p>
<p>A number of binaries change very rarely between releases and so can be copied
from a previous one:</p>
<div class="code bash highlight-python"><div class="highlight"><pre>cp v1.2.4/x86_64/composer_xe_2015.0.090/* v1.2.5/x86_64/composer_xe_2015.0.090
</pre></div>
</div>
<p>Edit the <code class="docutils literal"><span class="pre">README.md</span></code> file for the new release.</p>
<p>Update the <code class="docutils literal"><span class="pre">executables.ini</span></code> file</p>
<div class="highlight-bash"><div class="highlight"><pre>curl https://code.pycbc.phy.syr.edu/ligo-cbc/pycbc-config/download/master/O1/pipeline/executables.ini  -o executables.ini
sed -i <span class="s2">&quot;s+\${which:\\(.*\\)}+http://code.pycbc.phy.syr.edu/pycbc-software/v1.2.5/x86_64/composer_xe_2015.0.090/\1+&quot;</span> executables.ini
<span class="k">for</span> exe in <span class="sb">`</span>grep http://code.pycbc executables.ini <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span><span class="sb">`</span>
<span class="k">do</span>
  <span class="nb">echo</span> -e <span class="s2">&quot;[pegasus_profile-</span><span class="si">${</span><span class="nv">exe</span><span class="si">}</span><span class="s2">]\npycbc|installed = False\nhints|execution.site = local\n\n&quot;</span>
<span class="k">done</span> &gt; profiles
cat executables.ini profiles &gt; tmp
mv tmp executables.ini
rm profiles
</pre></div>
</div>
<p>Again, change version number and architecture as needed.</p>
</div>
<div class="section" id="lalapps-inspinj">
<h3>lalapps_inspinj<a class="headerlink" href="#lalapps-inspinj" title="Permalink to this headline">¶</a></h3>
<p>This is the one C program from lalsuite that is still needed in the current
workflow.  This almost never changes and so copying from the previous release
will generally be fine.  If it does need to be rebuilt follow the instructions
for installing lalsuite but configure with</p>
<div class="code highlight-python"><div class="highlight"><pre><span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">static</span><span class="o">-</span><span class="n">binaries</span> <span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">static</span> <span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">swig</span> <span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">lalstochastic</span> <span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">lalxml</span> <span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">lalinference</span> <span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">laldetchar</span> <span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">lalpulsar</span> <span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">framec</span>
</pre></div>
</div>
<p>Then <code class="docutils literal"><span class="pre">make</span></code> and <code class="docutils literal"><span class="pre">make</span> <span class="pre">install</span></code> as usual.  The static exexecutable will be placed in the
target <code class="docutils literal"><span class="pre">bin</span></code> directory.</p>
</div>
<div class="section" id="other-lalapps-programs">
<h3>Other lalapps programs<a class="headerlink" href="#other-lalapps-programs" title="Permalink to this headline">¶</a></h3>
<p>There are a few stochastic bank programs in lalsuite needed by pycbc.  These change infrequently and
can usually be copied from a previous release.  If they do need to be rebuilt the process is:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd</span> /path/to/your/lalsuite
<span class="nb">cd </span>lalapps/src/inspiral/

<span class="k">for</span> prog in <span class="se">\*</span>sbank<span class="se">\*</span>.py
<span class="k">do</span>
  pyinstaller <span class="si">${</span><span class="nv">prog</span><span class="si">}</span>                          <span class="se">\</span>
    --hidden-import scipy.linalg.cython_blas   <span class="se">\</span>
    --hidden-import scipy.linalg.cython_lapack <span class="se">\</span>
    --hidden-import scipy.special._ufuncs_cxx  <span class="se">\</span>
    --hidden-import scipy.integrate            <span class="se">\</span>
    --strip                                    <span class="se">\</span>
    --onefile
<span class="k">done</span>
</pre></div>
</div>
<p>The resulting bundles will be placed in the <code class="docutils literal"><span class="pre">dist</span></code> directory.</p>
</div>
<div class="section" id="segment-database-tools">
<h3>Segment database tools<a class="headerlink" href="#segment-database-tools" title="Permalink to this headline">¶</a></h3>
<p>Client tools for the segment database change infrequently and can usually be
copied from the previous release.  If they do need to be rebuilt the process is:</p>
<div class="highlight-bash"><div class="highlight"><pre>pyinstaller ligolw_segment_query_dqsegdb --strip --onefile
pyinstaller ligolw_segments_from_cats_dqsegdb --strip --onefile
</pre></div>
</div>
</div>
<div class="section" id="pycbc-binaries">
<h3>pyCBC binaries<a class="headerlink" href="#pycbc-binaries" title="Permalink to this headline">¶</a></h3>
<p>The program used to create a static binary from a Python program is
<a class="reference external" href="http://www.pyinstaller.org/">PyInstaller</a>.  To set up PyInstaller:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">source</span> /your/virtual/environment/bin/activate
<span class="nb">cd</span> /your/virtual/environment/src
git clone https://github.com/pyinstaller/pyinstaller.git
<span class="nb">cd </span>pyinstaller
git checkout 9d0e0ad4c1c02964bbff86edbf7400cd40958b1a
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The fix to <code class="docutils literal"><span class="pre">bootloader/common/pyi_utils.c</span></code> only needs to be done when installing the python 2.7 virtual environment.</p>
</div>
<p>By default programs built with PyInstaller will ignore the <code class="docutils literal"><span class="pre">LD_LIBRARY_PATH</span></code>
environment variable, which causes problems in some environments.  To fix this
edit <code class="docutils literal"><span class="pre">bootloader/common/pyi_utils.c</span></code> and replace the function <code class="docutils literal"><span class="pre">set_dynamic_library_path</span></code> with the following</p>
<div class="highlight-c"><div class="highlight"><pre><span class="k">static</span> <span class="kt">int</span> <span class="nf">set_dynamic_library_path</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">path</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">rc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cp">#ifdef AIX</span>
    <span class="cm">/* LIBPATH is used to look up dynamic libraries on AIX. */</span>
    <span class="n">setenv</span><span class="p">(</span><span class="s">&quot;LIBPATH&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">VS</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">);</span>
<span class="cp">#else</span>
    <span class="cm">/* LD_LIBRARY_PATH is used on other *nix platforms (except Darwin). */</span>
    <span class="kt">char</span> <span class="o">*</span> <span class="n">curpath</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span><span class="s">&quot;LD_LIBRARY_PATH&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="n">curpath</span> <span class="p">)</span> <span class="p">{</span> <span class="cm">/* Use required path only */</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="n">setenv</span><span class="p">(</span><span class="s">&quot;LD_LIBRARY_PATH&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">VS</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="cm">/* Append current path onto required path */</span>
        <span class="kt">char</span> <span class="n">apath</span><span class="p">[</span> <span class="n">strlen</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">curpath</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">];</span>
        <span class="n">strcpy</span><span class="p">(</span><span class="n">apath</span><span class="p">,</span> <span class="n">path</span><span class="p">);</span>
        <span class="n">strcat</span><span class="p">(</span><span class="n">apath</span><span class="p">,</span> <span class="s">&quot;:&quot;</span><span class="p">);</span>
        <span class="n">strcat</span><span class="p">(</span><span class="n">apath</span><span class="p">,</span> <span class="n">curpath</span><span class="p">);</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="n">setenv</span><span class="p">(</span><span class="s">&quot;LD_LIBRARY_PATH&quot;</span><span class="p">,</span> <span class="n">apath</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">VS</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">apath</span><span class="p">);</span>
    <span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* AIX */</span><span class="cp"></span>

    <span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then configure the bootloader and install as usual:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd </span>bootloader
./waf configure build install --no-lsb
<span class="nb">cd</span> ..
python setup.py install
</pre></div>
</div>
<p>To ensure that pyCBC is set up properly prior to running pyinstaller, first
clean out the pip cache</p>
<div class="code bash highlight-python"><div class="highlight"><pre>rm -rfv ${HOME}/.cache/pip
</pre></div>
</div>
<p>Then checkout the official release</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd</span> /your/virtual/environment/src
git clone git@github.com:ligo-cbc/pycbc.git
<span class="nb">cd </span>pycbc
git checkout v1.2.5
</pre></div>
</div>
<p>replacing <code class="docutils literal"><span class="pre">v1.2.5</span></code> with the version to be built.  Then install pyCBC, using
the requirements file to ensure the correct version of all dependancies is
installed</p>
<div class="code bash highlight-python"><div class="highlight"><pre>pip install -r requirements.txt
</pre></div>
</div>
<p>Then ensure that the installation went as expected:</p>
<div class="code highlight-python"><div class="highlight"><pre>pycbc_inspiral --version

Branch: None Tag: v1.2.5 Id: 51dcf08cc6016a7574c3baf2efff2bb60ed6ce4f Builder:
Larne Pekowsky &lt;larne.pekowsky@ligo.org&gt; Build date: 2015-10-31 14:48:20 +0000
Repository status is CLEAN: All modifications committed
</pre></div>
</div>
<p>The tag should match the one that was checked out and the repository status should
report as <code class="docutils literal"><span class="pre">CLEAN</span></code>.</p>
<p>To build static executables:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd </span>tools/static
bash build_dag.sh
</pre></div>
</div>
<p>This will construct a condor dag with a pyinstaller job for each binary.
Submit as usual:</p>
<div class="code bash highlight-python"><div class="highlight"><pre>condor_submit_dag build_static.dag
</pre></div>
</div>
<p>Assuming everything goes well the resulting binaries will be placed in the
<code class="docutils literal"><span class="pre">dist</span></code> directory.  As a final test, check the version again</p>
<div class="code highlight-python"><div class="highlight"><pre>dist/pycbc_inspiral --version

Branch: None Tag: v1.2.5 Id: 51dcf08cc6016a7574c3baf2efff2bb60ed6ce4f Builder:
Larne Pekowsky &lt;larne.pekowsky@ligo.org&gt; Build date: 2015-10-31 14:48:20 +0000
Repository status is CLEAN: All modifications committed
</pre></div>
</div>
<p>In principle jobs could fail if pyinstaller fails to build the executable,
although this has never been seen in practice.  A job can also fail if
pyinstaller succeeds but the resulting program throws an error when invoked
with <code class="docutils literal"><span class="pre">--help</span></code>.  Most of the time this happens it is because a new program has
been added and pyinstaller needs to be told that it needs scipy.  This is done
by adding the name of the new program to the <code class="docutils literal"><span class="pre">needs_full_build</span></code> file in the
<code class="docutils literal"><span class="pre">tools/static</span></code> directory.</p>
</div>
<div class="section" id="pycbc-inspiral">
<h3>pycbc_inspiral<a class="headerlink" href="#pycbc-inspiral" title="Permalink to this headline">¶</a></h3>
<p>This program needs to be built in a special environment so that it can be run on Open Science Grid sites.
All the necessary elements are available through CVMFS:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">source</span> /cvmfs/oasis.opensciencegrid.org/osg/modules/lmod/current/init/bash
module load python/2.7
</pre></div>
</div>
<p>Unfortunately it is now necessary to build an entire parallel develoment environment.  Move existing directories out of the way</p>
<div class="highlight-bash"><div class="highlight"><pre>mv <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/local <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/local_2.6
mv <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/.local <span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/.local_2.6
</pre></div>
</div>
<p>and repeat the installation instructions starting from installing pip.  You
will also need to rebuild lalsuite.  For clarity you may want to call the
virtual environment something like <code class="docutils literal"><span class="pre">pycbc_devel.2.7</span></code>.</p>
<p>Once this second environment is set up in order to build:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd </span>tools/static
./build_one.sh ../../bin/pycbc_inspiral
</pre></div>
</div>
<p>and ensure that the resulting executable has the correct version</p>
<div class="code highlight-python"><div class="highlight"><pre>dist/pycbc_inspiral --version

Branch: None Tag: v1.2.5 Id: 51dcf08cc6016a7574c3baf2efff2bb60ed6ce4f Builder:
Larne Pekowsky &lt;larne.pekowsky@ligo.org&gt; Build date: 2015-10-31 14:48:20 +0000
Repository status is CLEAN: All modifications committed
</pre></div>
</div>
</div>
<div class="section" id="finishing-up">
<h3>Finishing up<a class="headerlink" href="#finishing-up" title="Permalink to this headline">¶</a></h3>
<p>Once everything has been built and moved to the git repositry, commit and push as usual</p>
<div class="code bash highlight-python"><div class="highlight"><pre>git commit -a -m &quot;Version 1.2.5&quot;
git push
</pre></div>
</div>
<p>This will take some time.</p>
<p>Finally, the binaries will need to be put into place on the staging server, which must be done by someone with
root access.</p>
</div>
<div class="section" id="saving-virtual-environment">
<h3>Saving Virtual Environment<a class="headerlink" href="#saving-virtual-environment" title="Permalink to this headline">¶</a></h3>
<p>To save your virtual environment as a .tar file</p>
<p>Before creating a the next release</p>
<p>The same steps are followed for 2.7, replacing 2.6 with 2.7.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="install.html" class="btn btn-neutral float-right" title="Installing PyCBC" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="documentation.html" class="btn btn-neutral" title="Documenting PyCBC code" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Alexander Nitz.
      Last updated on Apr 12, 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>